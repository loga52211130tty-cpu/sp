<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>智慧藥盒模擬</title>
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center; }
  button { padding: 20px 40px; font-size: 24px; margin-top: 30px; }
  #status { margin-top: 20px; font-size: 20px; }
  #currentTime { margin-top: 10px; font-size: 18px; color: #555; }
  #log { margin-top: 30px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto;}
  #log ul { padding-left: 20px; }
</style>
</head>
<body>

<h1>智慧藥盒模擬</h1>

<button id="toggleBtn">馬</button>
<div id="status">目前狀態：關閉</div>
<div id="currentTime"></div>

<div id="log">
  <h2>歷史紀錄</h2>
  <ul id="recordList"></ul>
</div>

<script>
// ----------------------
// 初始化
// ----------------------
let boxOpened = false;
const toggleBtn = document.getElementById('toggleBtn');
const statusDiv = document.getElementById('status');
const recordList = document.getElementById('recordList');
const currentTimeDiv = document.getElementById('currentTime');

// 顯示當前時間
function updateCurrentTime() {
    const now = new Date();
    currentTimeDiv.textContent = `當前時間：${now.toLocaleString()}`;
}
setInterval(updateCurrentTime, 1000);
updateCurrentTime();

// ----------------------
// Google 表單設定
// ----------------------
// 1. 這裡填入你的 Google 表單 formResponse URL
const FORM_URL = "https://docs.google.com/forms/d/e/d/1s8o01rW7MiwN1T_Yb3wq61dRhFIcbKqmsU10lYaSsH8/formResponse";

// 2. 表單欄位 entry ID (需用瀏覽器開發者工具抓取)
// 假設「時間」欄位 entry.123456，「狀態」欄位 entry.654321
const TIME_ENTRY = "entry.123456";
const STATUS_ENTRY = "entry.654321";

// ----------------------
// 提交歷史紀錄到 Google 表單
// ----------------------
function submitToForm(status) {
    const now = new Date().toLocaleString();
    const formData = new FormData();
    formData.append(TIME_ENTRY, now);
    formData.append(STATUS_ENTRY, status);

    fetch(FORM_URL, { method: "POST", body: formData, mode: "no-cors" })
    .then(() => console.log("寫入表單成功"))
    .catch(err => console.error("寫入表單失敗", err));
}

// ----------------------
// 按鈕事件
// ----------------------
toggleBtn.addEventListener('click', () => {
    boxOpened = !boxOpened;
    const status = boxOpened ? "開啟" : "關閉";

    // 更新網頁歷史紀錄
    const li = document.createElement('li');
    li.textContent = `${status} - ${new Date().toLocaleString()}`;
    recordList.appendChild(li);
    li.scrollIntoView({behavior: "smooth"});

    // 寫入 Google 表單
    submitToForm(status);
});
</script>

</body>
</html>

